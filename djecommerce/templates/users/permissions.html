{% extends "base.html" %}

{% block content %}

<div class="container">
	<div class="row">
        <div class="col-lg-12">
            <h2 class="page-header" style="margin:0px; !important">Staff Permissions</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
            	<form name="role_form" method="post">{% csrf_token %}
            	<div class="panel-heading">
                    Role Name: <input {% if role %}value="{{role.name}}"{% endif %} name="role_name" type="text" maxlength="17" style="display:inline-block;">
                </div>
                <div class="panel-body">
                    <div class="row">
                        <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                            <thead>
                                <tr>
                                    <th>Permission</th>
                                    <th>Can Access</th>
                                    <th>Can Add</th>
                                    <th>Can Update</th>
                                    <th>Can Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="odd gradeX">
                                    <td>Product</td>
                                    <td><input type="checkbox" value="access_product" {% if 'access_product' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="add_product" {% if 'add_product' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="change_product" {% if 'change_product' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="delete_product" {% if 'delete_product' in permissions %}checked{% endif %} name="perms"></td>
                                </tr>
                                <tr class="odd gradeX">
                                    <td>Attribute</td>
                                    <td><input type="checkbox" value="access_productattribute" {% if 'access_productattribute' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="add_productattribute" {% if 'add_productattribute' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="change_productattribute" {% if 'change_productattribute' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="delete_productattribute" {% if 'delete_productattribute' in permissions %}checked{% endif %} name="perms"></td>
                                </tr>
                                <tr class="odd gradeX">
                                    <td>Category</td>
                                    <td><input type="checkbox" value="access_catalogcategory" {% if 'access_catalogcategory' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="add_catalogcategory" {% if 'add_catalogcategory' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="change_catalogcategory" {% if 'change_catalogcategory' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="delete_catalogcategory" {% if 'delete_catalogcategory' in permissions %}checked{% endif %} name="perms"></td>
                                </tr>
                                <tr class="odd gradeX">
                                    <td>Catalog</td>
                                    <td><input type="checkbox" value="access_catalog" {% if 'access_catalog' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="add_catalog" {% if 'add_catalog' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="change_catalog" {% if 'change_catalog' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="delete_catalog" {% if 'delete_catalog' in permissions %}checked{% endif %} name="perms"></td>
                                </tr>
                                <tr class="odd gradeX">
                                    <td>Tax</td>
                                    <td><input type="checkbox" value="access_tax" {% if 'access_tax' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="add_tax" {% if 'add_tax' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="change_tax" {% if 'change_tax' in permissions %}checked{% endif %} name="perms"></td>
                                    <td><input type="checkbox" value="delete_tax" {% if 'delete_tax' in permissions %}checked{% endif %} name="perms"></td>
                                </tr>
                                <tr class="odd gradeX">
                                    <td>Import</td>
                                    <td><input type="checkbox" value="access_import" {% if role.is_import %}checked{% endif %} name="perms"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr class="odd gradeX">
                                    <td>Export</td>
                                    <td><input type="checkbox" value="access_export" {% if role.is_export %}checked{% endif %} name="perms"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <label style="padding-left:20px;padding-top:20px;">Staff assigned to this role can add products to these categories:</label>
                        <div style="padding-left:20px;padding-top:10px;display:inline-block;">
                            <select multiple id="id_parent_category" name="parent_category" class="form-control">
                                {% for cat in parent_cats %}
                                    <option {% if cat in role.categories.all %}selected{% endif %} 
                                        value="{{cat.id}}">{{cat.name}}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div style="padding-left:20px;padding-top:20px;">
        			    	<a class="btn btn-default" href="{% url 'staff_management' %}" role="button">Cancel</a>
                            <button type="submit" name="submit" class="btn btn-default">Save</button>
                        </div>
                    </div>
                    
                </div>
                <input type="hidden" {% if role %}value="{{role.id}}"{% endif %} name="grp_id">
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function(){

    $("form[name='role_form']").validate({
        rules: {
            role_name: "required",
        },
        messages: {
            role_name: "Please enter the role name",
        },
        submitHandler: function(form) {
            form.submit();
        }
    });

	$('#id_parent_category').multiselect({
		includeSelectAllOption: true,
		enableFiltering: true,
        maxHeight: 470,
        dropUp: true,
        buttonWidth: '280px',
        buttonText: function(options, select) {
            if (options.length === 0) {
                return 'None';
            }
        }
	});
	{% if not role %}
		$('#id_parent_category').multiselect('selectAll', false);
		$('#id_parent_category').multiselect('updateButtonText');
	{% endif %}

	$("input[type='checkbox']").change(function() {
	    if(this.checked) {
	        if((this.value.indexOf('add') !== -1) || (this.value.indexOf('change') !== -1) || (this.value.indexOf('delete') !== -1)){
	        	access_val = 'access_'+this.value.split('_')[1];
	        	$("input[value='"+access_val+"']").prop('checked', true);
	        }
	    }else{
	    	// app = this.value.split('_')[1];
	    	// if(!$("input[value='add_"+app+"']").is(':checked') && !$("input[value='change_"+app+"']").is(':checked') && !$("input[value='delete_"+app+"']").is(':checked')){
	    	// 	$("input[value='"+access_val+"']").prop('checked', false);
	    	// }
	    }
	});

});    
</script>
{% endblock %}