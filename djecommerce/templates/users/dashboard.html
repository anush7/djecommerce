{% extends "base.html" %}

{% block content %}
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 style="margin-top:10px; !important" class="page-header">
                    Product Stats
                </h1>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">            
                <div id="container1"></div>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">            
                <div id="container2"></div>
            </div>

            <div class="col-lg-12">
                <h1 style="margin-top:10px; !important" class="page-header">
                    Order Stats
                </h1>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">            
                <div id="container3"></div>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">            
                <div id="container4"></div>
            </div>
        </div> 
    </div>
<script type="text/javascript">
$(function () {
    var dataString = '';
    $.ajax({
        type: 'GET',
        dataType: 'json',
        data: dataString,
        url: "{% url 'products-stats' %}",
        success: function(data){
            create_product_stackchart('container1', data.categories, data.series);
        }
    });

    $.ajax({
        type: 'GET',
        dataType: 'json',
        data: dataString,
        url: "{% url 'products-cats' %}",
        success: function(data){
            create_product_piechart('container2', data.series);
        }
    });

    $.ajax({
        type: 'GET',
        dataType: 'json',
        data: dataString,
        url: "{% url 'orders-stats' %}",
        success: function(data){
            create_order_stackchart('container3', data.categories, data.series);
        }
    });
});

function create_order_stackchart(chart_id, categories, series){

    $('#'+chart_id).highcharts({
        chart: {
            type: 'area'
        },
        title: {
            text: 'Revenue'
        },
        xAxis: {
            allowDecimals: false,
            categories: categories
        },
        yAxis: {
            title: {
                text: '$'
            },
            labels: {
                formatter: function () {
                    return this.value;
                }
            }
        },
        plotOptions: {
            area: {
                marker: {
                    enabled: false,
                    symbol: 'circle',
                    radius: 2,
                    states: {
                        hover: {
                            enabled: true
                        }
                    }
                }
            }
        },
        series: series
    });
}

function create_product_stackchart(chart_id, categories, series){

    $('#'+chart_id).highcharts({
        chart: {
            type: 'area'
        },
        title: {
            text: 'Products added'
        },
        xAxis: {
            allowDecimals: false,
            categories: categories
        },
        yAxis: {
            title: {
                text: 'Products count'
            },
            labels: {
                formatter: function () {
                    return this.value;
                }
            }
        },
        plotOptions: {
            area: {
                marker: {
                    enabled: false,
                    symbol: 'circle',
                    radius: 2,
                    states: {
                        hover: {
                            enabled: true
                        }
                    }
                }
            }
        },
        series: series
    });
}

function create_product_piechart(chart_id, series){

    $('#'+chart_id).highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        title: {
            text: 'Products in Categories'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: series
    });
}

</script>

{% endblock %}