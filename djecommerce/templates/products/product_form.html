{% extends "base.html" %}

{% block content %}
{% load staticfiles %}

<div class="container">
	<div class="row">
		{% if product %}
		<ul class="nav nav-tabs">
			<li role="presentation" class="active"><a href="{{product.get_absolute_url}}">Product</a></li>
			<li role="presentation"><a href="{{product.get_variants_url}}">Variants</a></li>
			<li role="presentation"><a href="{{product.get_stocks_url}}">Stock</a></li>
			<li role="presentation"><a href="{{product.get_images_url}}">Images</a></li>
		</ul>
		{% endif %}
	</div>
	<div class="row" style="margin-top:15px;">
		<form method='post' class="form-horizontal">{% csrf_token %}

			<div class="form-group">
				<label for="id_title" class="col-md-2 control-label">Title</label>
				<div class="col-xs-4">
					{{form.title}}
					<p style="color:red;">{{ form.title.errors.as_text }}</p>
				</div>
			</div>
			<div class="form-group">
				<label for="id_content" class="col-sm-2 control-label">Description</label>
				<div class="col-xs-6">
					{{form.description}}
					<p style="color:red;">{{ form.description.errors.as_text }}</p>
				</div>
			</div>
			<div class="form-group">
				<label for="id_title" class="col-sm-2 control-label">Category</label>
				<div class="col-xs-3">
					<select id="id_parent_category" name="parent_category" class="form-control">
						<option>--</option>
			            {% for cat in parent_cats %}
			                <option {% if cat.id == selected_parent_cat.id %}selected{% endif %} 
			                	value="{{cat.id}}">{{cat.name}}
			                </option>
			            {% endfor %}
			        </select>
			    	<p style="color:red;">{{ form.type.errors.as_text }}</p>
				</div>
			</div>
			<div id="id_sub_cats">
				{% if product %}
					<div class="form-group">
						<label for="id_title" class="col-sm-2 control-label">Sub Category</label>
						<div class="col-xs-3">
							<select multiple id="id_category" name="category" class="form-control">
					            {% for scat in sub_cats %}
					                <option {% if scat in product.categories.all  %}selected{% endif %} value="{{scat.id}}">{{scat.name}}</option>
					            {% endfor %}
					        </select>
					    	<p style="color:red;">{{ form.type.errors.as_text }}</p>
						</div>
					</div>
				{% endif %}
			</div>

			<div class="form-group">
				<label for="id_title" class="col-sm-2 control-label">Attributes</label>
				<div class="col-xs-3">
					{{form.attributes}}
			    	<p style="color:red;">{{ form.attributes.errors.as_text }}</p>
				</div>
			</div>

			<div class="form-group">
				<label for="id_content" class="col-sm-2 control-label">Price</label>
				<div class="col-xs-2">
					{{form.price}}
					<p style="color:red;">{{ form.price.errors.as_text }}</p>
				</div>
			</div>
			<div class="form-group">
			    <div class="col-sm-offset-2 col-xs-3">
			    	<button type="submit" name="submit" value="I" class="btn btn-default">
			    		{% if product %}
			    			Save
			    		{% else %}
			    			Save and Add Variant
			    		{% endif %}
			    		</button>
			    	<a class="btn btn-default" href="{% url 'staff-product-list' %}" role="button">Cancel</a>
			    </div>
			</div>
		</form>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function(){
	$('#id_category').multiselect({
		includeSelectAllOption: true,
		enableFiltering: true
	});
	$('#id_attributes').multiselect({
		includeSelectAllOption: true,
		enableFiltering: true
	});

    $('#id_parent_category').change(function() {
    	var parentcat = $('#id_parent_category option:selected').val();
        var dataString='';
        dataString += 'csrfmiddlewaretoken={{csrf_token}}&pid='+parentcat;
        {% if product %}
        	dataString += '&product_id='+{{product.id}}
        {% endif %}
        $.ajax({
            type: 'POST',
            dataType: 'json',
            data: dataString,
            url: '{% url "staff-ajax-load-prod-subcats" %}',
            success: function(data){
            	if(data['status'] == 1){
            		$('#id_sub_cats').empty().append(data['html']);
            		$('#id_category').multiselect({
						includeSelectAllOption: true,
						enableFiltering: true
					});
            	}else{
            		$('#id_sub_cats').empty()
            	}
            }
        });
    });

    // $('#id_sub_cats').on('change','#id_category',function() {
    // 	var sub_cat_ids = $('#id_category').val();
    //     var dataString='';
    //     dataString += 'csrfmiddlewaretoken={{csrf_token}}&sub_cat_ids='+sub_cat_ids;
    //     {% if product %}
    //     	dataString += '&product_id='+{{product.id}}
    //     {% endif %}
    //     $.ajax({
    //         type: 'POST',
    //         dataType: 'json',
    //         data: dataString,
    //         url: '{#% url "staff-ajax-load-prod-attributes" %#}',
    //         success: function(data){
    //         	if(data['status'] == 1){
    //         		$('#id_attrs').empty().append(data['html']);
    //         		$('#id_attributes').multiselect({
				// 		includeSelectAllOption: true,
				// 		enableFiltering: true
				// 	});
    //         	}else{
    //         		$('#id_attrs').empty()
    //         	}
    //         }
    //     });
    // });

});    
</script>
{% endblock %}